{% extends 'layout.html' %}

{% block title %}
  {{ carreira.nome }}
{% endblock %}

{% block time %}
  {{ carreira.treinador }}
{% endblock %}

{% block content %}
  {% load static %}
  <div class="container my-5">
    <h1 class="text-center">{{ carreira.nome }} - Estatísticas</h1>
    <h3 class="text-center text-muted">{{ carreira.treinador }}</h3>

    <!-- Botão para abrir o modal -->
    <div class="text-center my-4">
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#adicionarEstatisticaModal"><i class="bi bi-plus-lg"></i> Adicionar Estatística</button>
    </div>

    <!-- Modal de Adicionar Estatística -->
<div class="modal fade" id="adicionarEstatisticaModal" tabindex="-1" aria-labelledby="adicionarEstatisticaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adicionarEstatisticaLabel">Adicionar Nova Estatística</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{% url 'adicionar_estatistica' carreira.id %}">
        {% csrf_token %}
        <div class="modal-body">
          <!-- Inputs do Modal -->
          <div class="mb-3">
            <label for="jogador" class="form-label">Jogador</label>
            <select class="form-select" id="jogador" name="jogador_id" required>
              {% for jogador in carreira.carreira_times_jogadores.all %}
                <option value="{{ jogador.jogador.id }}">{{ jogador.jogador.nome }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="campeonato" class="form-label">Campeonato</label>
            <select class="form-select" id="campeonato" name="campeonato_id" required>
              {% for campeonato in campeonatos %}
                <option value="{{ campeonato.id }}">{{ campeonato.nome }}</option>
              {% endfor %}
            </select>
            <!-- Botão para abrir o modal de adicionar campeonato -->
            <button type="button" class="btn btn-link mt-2" data-bs-toggle="modal" data-bs-target="#adicionarCampeonatoModal">
              Adicionar Novo Campeonato
            </button>
          </div>
          <div class="mb-3">
            <label for="temporada" class="form-label">Temporada</label>
            <select class="form-select" id="temporada" name="temporada_id" required>
              {% for temporada in temporadas %}
                <option value="{{ temporada.id }}">{{ temporada.data }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="jogos" class="form-label">Quantidade de Jogos</label>
            <input type="number" class="form-control" id="jogos" name="jogos" min="0" required />
          </div>
          <div class="mb-3">
            <label for="gols" class="form-label">Gols</label>
            <input type="number" class="form-control" id="gols" name="gols" min="0" required />
          </div>
          <div class="mb-3">
            <label for="assistencias" class="form-label">Assistências</label>
            <input type="number" class="form-control" id="assistencias" name="assistencias" min="0" required />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>


    <!-- Lista de Estatísticas -->
    <div class="mt-4">
      <h4 class="text-center">Estatísticas por Temporada</h4>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Jogador</th>
              <th>Temporada</th>
              <th>Campeonato</th>
              <th>Jogos</th>
              <th>Gols</th>
              <th>Assistências</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for estatistica in carreira.estatisticas.all %}
              <tr>
                <!-- Jogador -->
                <td>
                  <div class="d-flex align-items-center">
                    {% if estatistica.jogador.foto %}
                      <img src="{{ estatistica.jogador.foto.url }}" class="rounded-circle me-2" alt="Foto de {{ estatistica.jogador.nome }}" style="width: 40px; height: 40px; object-fit: cover;" />
                    {% else %}
                      <img src="{% static 'img/default-player.png' %}" class="rounded-circle me-2" alt="Foto padrão" style="width: 40px; height: 40px;" />
                    {% endif %}
                    {{ estatistica.jogador.nome }}
                  </div>
                </td>

                <!-- Temporada -->
                <td>{{ estatistica.temporada.data }}</td>

                <!-- Campeonato -->
                <td>
                  <div class="d-flex align-items-center">
                    {% if estatistica.campeonato.logo %}
                      <img src="{{ estatistica.campeonato.logo.url }}" class="me-2" alt="Logo {{ estatistica.campeonato.nome }}" style="width: 40px; height: 40px; object-fit: contain;" />
                    {% else %}
                      <img src="{% static 'img/default-league.png' %}" class="me-2" alt="Logo padrão" style="width: 40px; height: 40px;" />
                    {% endif %}
                    {{ estatistica.campeonato.nome }}
                  </div>
                </td>

                <!-- Estatísticas -->
                <td>{{ estatistica.jogos }}</td>
                <td>{{ estatistica.gols }}</td>
                <td>{{ estatistica.assistencias }}</td>

                <!-- Botões de Ação -->
                <td class="text-center">
                  <!-- Botão Editar -->
                  <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editarEstatisticaModal{{ estatistica.id }}"><i class="bi bi-pencil-square"></i> Editar</button>

                  <!-- Botão Excluir -->
                  <form method="POST" action="{% url 'excluir_estatistica' estatistica.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir esta estatística?');"><i class="bi bi-trash"></i> Excluir</button>
                  </form>
                </td>
              </tr>

              <!-- Modal de Edição -->
              <div class="modal fade" id="editarEstatisticaModal{{ estatistica.id }}" tabindex="-1" aria-labelledby="editarEstatisticaLabel{{ estatistica.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="editarEstatisticaLabel{{ estatistica.id }}">Editar Estatística</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="POST" action="{% url 'editar_estatistica' estatistica.id %}">
                      {% csrf_token %}
                      <div class="modal-body">
                        <!-- Campos de Edição -->
                        <div class="mb-3">
                          <label for="jogos{{ estatistica.id }}" class="form-label">Quantidade de Jogos</label>
                          <input type="number" class="form-control" id="jogos{{ estatistica.id }}" name="jogos" value="{{ estatistica.jogos }}" min="0" required />
                        </div>
                        <div class="mb-3">
                          <label for="gols{{ estatistica.id }}" class="form-label">Gols</label>
                          <input type="number" class="form-control" id="gols{{ estatistica.id }}" name="gols" value="{{ estatistica.gols }}" min="0" required />
                        </div>
                        <div class="mb-3">
                          <label for="assistencias{{ estatistica.id }}" class="form-label">Assistências</label>
                          <input type="number" class="form-control" id="assistencias{{ estatistica.id }}" name="assistencias" value="{{ estatistica.assistencias }}" min="0" required />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center">Nenhuma estatística encontrada.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- Modal de Adicionar Campeonato -->
<div class="modal fade" id="adicionarCampeonatoModal" tabindex="-1" aria-labelledby="adicionarCampeonatoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adicionarCampeonatoLabel">Adicionar Novo Campeonato</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{% url 'adicionar_campeonato' carreira.id %}">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="campeonatoNome" class="form-label">Nome do Campeonato</label>
            <input type="text" class="form-control" id="campeonatoNome" name="nome" required />
          </div>
          <div class="mb-3">
            <label for="campeonatoLogo" class="form-label">Logo do Campeonato (Opcional)</label>
            <input type="file" class="form-control" id="campeonatoLogo" name="logo" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Adicionar Campeonato</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
